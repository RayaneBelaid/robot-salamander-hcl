<!-- HTML header for doxygen 1.9.7-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Dynamixel library (p1): How to use</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen-awesome-sidebar-only-darkmode-toggle.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen-awesome-KM-robota.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../doxygen-awesome-darkmode-toggle.js"></script>
<script type="text/javascript">
    DoxygenAwesomeDarkModeToggle.init()
</script>
<script type="text/javascript" src="../../doxygen-awesome-interactive-toc.js"></script>
<script type="text/javascript">
    DoxygenAwesomeInteractiveToc.init()
</script>
<script type="text/javascript" src="../../doxygen-awesome-fragment-copy-button.js"></script>
<script type="text/javascript">
    DoxygenAwesomeFragmentCopyButton.init()
</script>
<script type="text/javascript" src="../../doxygen-awesome-paragraph-link.js"></script>
<script type="text/javascript">
    DoxygenAwesomeParagraphLink.init()
</script>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="../../logo.svg"/></td>
 </tr>
 <tr>
  <td id="projectalign">
   <div id="projectname">Dynamixel library (p1)</div>
   <div id="projectnumber">1.0.0</div>
   <!--div id="projectbrief">Awesome robot</div>-->
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('d4/da5/how-to-use.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">How to use</div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#autotoc_md9">I. Initializations</a><ul><li class="level2"><a href="#autotoc_md10">Step 1: Write a motor configuration file</a></li>
<li class="level2"><a href="#autotoc_md11">Step 2: Initialize hal</a></li>
</ul>
</li>
<li class="level1"><a href="#autotoc_md12">II. Create your Robot class</a><ul><li class="level2"><a href="#autotoc_md13">Step 3: Declare Robot</a></li>
<li class="level2"><a href="#autotoc_md14">Step 4: Writer handlers</a></li>
<li class="level2"><a href="#autotoc_md15">Step 5: Reader handlers</a></li>
<li class="level2"><a href="#autotoc_md16">Note: multiturn reset</a></li>
</ul>
</li>
<li class="level1"><a href="#autotoc_md17">III. Create a Robot object</a></li>
</ul>
</div>
<div class="textblock"><p>The library lives in the KMR::dxl namespace.</p>
<h1><a class="anchor" id="autotoc_md9"></a>
I. Initializations</h1>
<h2><a class="anchor" id="autotoc_md10"></a>
Step 1: Write a motor configuration file</h2>
<p>The first thing that needs to be done is to create a yaml configuration file of the motors used in the projet. <br  />
Let's assume the robot has 4 motors with IDs {1, 2, 3, 4}, all of model MX_64R. Motors 1 and 3 are in multiturn mode, while the 2 others are not. <br  />
The motor configuration file will look as follows:</p>
<div class="fragment"><div class="line"># motors_config.yaml</div>
<div class="line">nbr_motors: 4    </div>
<div class="line">motors: </div>
<div class="line">  - ID: 1</div>
<div class="line">    model: MX_64R</div>
<div class="line">    multiturn: 1</div>
<div class="line">  - ID: 2</div>
<div class="line">    model: MX_64R</div>
<div class="line">    multiturn: 0</div>
<div class="line">  - ID: 3</div>
<div class="line">    model: MX_64R</div>
<div class="line">    multiturn: 1</div>
<div class="line">  - ID: 4</div>
<div class="line">    model: MX_64R</div>
<div class="line">    multiturn: 0</div>
</div><!-- fragment --><p>The multiturn mode corresponds to the "extended position control" in dynamixel's SDK. It's a position control allowing 255 turns in each direction before the input value saturates. In order to avoid saturation and thus, to allow motors turning indefinitely, this library resets a motor after it does more than a full turn relative to its starting 0 position. <br  />
After the reset, the motor thus detects its position as being between -180° and +180° again. <br  />
</p>
<p>In addition to setting the "multiturn" configuration in the yaml file correctly, the motors themselves must of course be configured for the correct operation mode.</p>
<p><em>Note</em>: the "multiturn" configuration must always be present in the yaml file, even if it's not used in any motor. Just set it to 0 for each motor.</p>
<h2><a class="anchor" id="autotoc_md11"></a>
Step 2: Initialize hal</h2>
<p>The second step is to initialize a KMR::dxl::Hal object in the project's main file. <br  />
This allows to make sure the motors configuration files are correct, as well as to create the hidden control tables used to abstract the hardware layer:</p>
<div class="fragment"><div class="line"><span class="comment">// In main.cpp</span></div>
<div class="line">KMR::dxl::Hal hal;</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">char</span> path_to_motor_config[] = <span class="stringliteral">&quot;../config/motors_config.yaml&quot;</span>;</div>
<div class="line"><span class="keywordtype">char</span> path_to_KMR_dxl[] = <span class="stringliteral">&quot;../KMR_dxl&quot;</span>;</div>
<div class="line"> </div>
<div class="line">std::vector&lt;int&gt; all_ids = hal.init(path_to_motor_config, path_to_KMR_dxl);</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md12"></a>
II. Create your Robot class</h1>
<h2><a class="anchor" id="autotoc_md13"></a>
Step 3: Declare Robot</h2>
<p>The project's <a class="el" href="../../de/d78/classRobot.html">Robot</a> class needs to inherit KMR::dxl::BaseRobot, which results in this class declaration:</p>
<div class="fragment"><div class="line"><span class="comment">// robot.hpp</span></div>
<div class="line"><span class="keyword">class </span><a class="code hl_class" href="../../de/d78/classRobot.html">Robot</a> : <span class="keyword">public</span> KMR::dxl::BaseRobot {</div>
<div class="line">    ....</div>
<div class="line">};</div>
<div class="ttc" id="aclassRobot_html"><div class="ttname"><a href="../../de/d78/classRobot.html">Robot</a></div><div class="ttdef"><b>Definition</b> robot.hpp:21</div></div>
</div><!-- fragment --><p> and this constructor:</p>
<div class="fragment"><div class="line"><span class="comment">// robot.cpp</span></div>
<div class="line"><a class="code hl_function" href="../../de/d78/classRobot.html#ae4fc25df0af461357d3ba1020cfca9ff">Robot::Robot</a>(vector&lt;int&gt; all_ids, <span class="keyword">const</span> <span class="keywordtype">char</span> *port_name, <span class="keywordtype">int</span> baudrate, KMR::dxl::Hal hal)</div>
<div class="line">: <a class="code hl_namespace" href="../../d7/d19/namespaceKMR.html">KMR</a>::dxl::BaseRobot(all_ids, port_name, baudrate, hal)</div>
<div class="line">{</div>
<div class="line">    ...</div>
<div class="line">}</div>
<div class="ttc" id="aclassRobot_html_ae4fc25df0af461357d3ba1020cfca9ff"><div class="ttname"><a href="../../de/d78/classRobot.html#ae4fc25df0af461357d3ba1020cfca9ff">Robot::Robot</a></div><div class="ttdeci">Robot(std::vector&lt; int &gt; all_ids, const char *port_name, int baudrate, KMR::dxlP1::Hal hal)</div><div class="ttdoc">Constructor for LibRobot.</div><div class="ttdef"><b>Definition</b> robot.cpp:29</div></div>
<div class="ttc" id="anamespaceKMR_html"><div class="ttname"><a href="../../d7/d19/namespaceKMR.html">KMR</a></div><div class="ttdef"><b>Definition</b> KMR_dxlP1_hal.hpp:24</div></div>
</div><!-- fragment --> <h2><a class="anchor" id="autotoc_md14"></a>
Step 4: Writer handlers</h2>
<p>To create a handler that sends data to the motors (example: goal positions, LED control), a KMR::dxl::Writer object is used. <br  />
It can be declared as a private member of <a class="el" href="../../de/d78/classRobot.html">Robot</a>:</p>
<div class="fragment"><div class="line"><span class="comment">// robot.hpp</span></div>
<div class="line"><span class="keyword">class </span><a class="code hl_class" href="../../de/d78/classRobot.html">Robot</a> : <span class="keyword">public</span> KMR::dxl::BaseRobot {</div>
<div class="line">    <span class="keyword">private</span>:</div>
<div class="line">        KMR::dxl::Writer *<a class="code hl_variable" href="../../de/d78/classRobot.html#a2d028e36d975089678117edb1dd550d2">m_writer</a>;</div>
<div class="line">};</div>
<div class="ttc" id="aclassRobot_html_a2d028e36d975089678117edb1dd550d2"><div class="ttname"><a href="../../de/d78/classRobot.html#a2d028e36d975089678117edb1dd550d2">Robot::m_writer</a></div><div class="ttdeci">KMR::dxlP1::Writer * m_writer</div><div class="ttdef"><b>Definition</b> robot.hpp:23</div></div>
</div><!-- fragment --><p>and initialized in <a class="el" href="../../de/d78/classRobot.html">Robot</a>'s constructor: </p><div class="fragment"><div class="line">m_writer = <span class="keyword">new</span> KMR::dxl::Writer(writer_fields, ids, portHandler_, packetHandler_, m_hal, 0);</div>
</div><!-- fragment --><p> The "writer_fields" is the list of field(s) that will be handled by this specific Writer object. Since this library uses the protocol 2 of dynamixel's SDK, a single Writer can handle several control fields, resulting in an indirect address writing - but this is handled by the library automatically.</p>
<p>The fields themselves are enumerated in KMR::dxl::Fields and correspond to control fields found in Dynamixels' control tables, as in <a href="https://emanual.robotis.com/docs/en/dxl/mx/mx-64-2/#control-table">https://emanual.robotis.com/docs/en/dxl/mx/mx-64-2/#control-table</a> <br  />
 For example, if we wish to have a Writer handler that sends goal positions and LED status commands to motors, the Writer definition becomes:</p>
<div class="fragment"><div class="line">vector&lt;KMR::dxl::Fields&gt; writer_fields = {KMR::dxl::GOAL_POS, KMR::dxl::LED};</div>
<div class="line">m_writer = <span class="keyword">new</span> KMR::dxl::Writer(writer_fields, ids, portHandler_, packetHandler_, m_hal, 0);</div>
</div><!-- fragment --><p>Finally, the last element we need to use the Writer is the function that actually sends the data to motors. The creation of this function is very straightforward.</p>
<p>The method KMR::dxl::Writer::addDataToWrite allows to save data that need to be sent to motors into the Writer's private attribute table. Then, once all the data is updated, it is sent with the method KMR::dxl::Writer::syncWrite. <br  />
 Keeping the same Writer example, a public method can be defined inside <a class="el" href="../../de/d78/classRobot.html">Robot</a>:</p>
<div class="fragment"><div class="line"><span class="comment">// robot.cpp</span></div>
<div class="line"><span class="keywordtype">void</span> <a class="code hl_function" href="../../de/d78/classRobot.html#a6e237131559176b242caa699b94c5ecf">Robot::writeData</a>(vector&lt;float&gt; angles, vector&lt;int&gt; LED_vals, vector&lt;int&gt; ids)</div>
<div class="line">{</div>
<div class="line">    <a class="code hl_variable" href="../../de/d78/classRobot.html#a2d028e36d975089678117edb1dd550d2">m_writer</a>-&gt;<a class="code hl_function" href="../../d9/d9d/classKMR_1_1dxlP1_1_1Writer.html#aa5b2335198e2a95897a6cf8c698c396c">addDataToWrite</a>(angles, KMR::dxl::GOAL_POS, ids);</div>
<div class="line">    <a class="code hl_variable" href="../../de/d78/classRobot.html#a2d028e36d975089678117edb1dd550d2">m_writer</a>-&gt;<a class="code hl_function" href="../../d9/d9d/classKMR_1_1dxlP1_1_1Writer.html#aa5b2335198e2a95897a6cf8c698c396c">addDataToWrite</a>(LED_vals, KMR::dxl::LED, ids);</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_variable" href="../../de/d78/classRobot.html#a2d028e36d975089678117edb1dd550d2">m_writer</a>-&gt;<a class="code hl_function" href="../../d9/d9d/classKMR_1_1dxlP1_1_1Writer.html#abb7dfb8e49cb7ca54b8d007b1f947730">syncWrite</a>(ids);</div>
<div class="line">}</div>
<div class="ttc" id="aclassKMR_1_1dxlP1_1_1Writer_html_aa5b2335198e2a95897a6cf8c698c396c"><div class="ttname"><a href="../../d9/d9d/classKMR_1_1dxlP1_1_1Writer.html#aa5b2335198e2a95897a6cf8c698c396c">KMR::dxlP1::Writer::addDataToWrite</a></div><div class="ttdeci">void addDataToWrite(std::vector&lt; T &gt; data, std::vector&lt; int &gt; ids)</div><div class="ttdoc">Add data to the list to be sent later with syncWrite.</div><div class="ttdef"><b>Definition</b> KMR_dxlP1_writer.hpp:63</div></div>
<div class="ttc" id="aclassKMR_1_1dxlP1_1_1Writer_html_abb7dfb8e49cb7ca54b8d007b1f947730"><div class="ttname"><a href="../../d9/d9d/classKMR_1_1dxlP1_1_1Writer.html#abb7dfb8e49cb7ca54b8d007b1f947730">KMR::dxlP1::Writer::syncWrite</a></div><div class="ttdeci">void syncWrite(std::vector&lt; int &gt; ids)</div><div class="ttdoc">Send the previously prepared data with addDataToWrite to motors.</div><div class="ttdef"><b>Definition</b> KMR_dxlP1_writer.cpp:99</div></div>
<div class="ttc" id="aclassRobot_html_a6e237131559176b242caa699b94c5ecf"><div class="ttname"><a href="../../de/d78/classRobot.html#a6e237131559176b242caa699b94c5ecf">Robot::writeData</a></div><div class="ttdeci">void writeData(std::vector&lt; float &gt; angles, std::vector&lt; int &gt; ids)</div><div class="ttdef"><b>Definition</b> robot.cpp:44</div></div>
</div><!-- fragment --><p>This public method <a class="el" href="../../de/d78/classRobot.html#a6e237131559176b242caa699b94c5ecf">Robot::writeData</a> can be for example called from the main when new control values are received from the controller.</p>
<h2><a class="anchor" id="autotoc_md15"></a>
Step 5: Reader handlers</h2>
<p>In order to fetch data from the motors' sensors (for example current position and temperature), a KMR::dxl::Reader object is required. It works extremely similarly to its Writer counterpart.</p>
<p>When writing the read function, one needs to be careful about the order in which the control fields were written when declaring the Reader. <br  />
The method KMR::dxl::Reader::syncRead stores the data received from motors into the Reader's attribute table "m_dataFromMotor", organized like this:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone"></th><th class="markdownTableHeadNone">field1   </th><th class="markdownTableHeadNone">field2   </th><th class="markdownTableHeadNone">....   </th><th class="markdownTableHeadNone">field_n    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">id[0]   </td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">...   </td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">id[last]   </td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone"></td></tr>
</table>
<p>As such, if for example we wanted a Reader that reads present position and LED status, the declaration would be: </p><div class="fragment"><div class="line">vector&lt;KMR::dxl::Fields&gt; reader_fields = {KMR::dxl::PRESENT_POS, KMR::dxl::LED};</div>
<div class="line">m_reader = <span class="keyword">new</span> KMR::dxl::Reader(reader_fields, <a class="code hl_variable" href="../../d1/de1/test__dxlP1_8cpp.html#adaa9a0d2fadfd52f45de06467a454543">handlers_ids</a>, portHandler_, packetHandler_, m_hal, 0);</div>
<div class="ttc" id="atest__dxlP1_8cpp_html_adaa9a0d2fadfd52f45de06467a454543"><div class="ttname"><a href="../../d1/de1/test__dxlP1_8cpp.html#adaa9a0d2fadfd52f45de06467a454543">handlers_ids</a></div><div class="ttdeci">vector&lt; int &gt; handlers_ids</div><div class="ttdef"><b>Definition</b> test_dxlP1.cpp:34</div></div>
</div><!-- fragment --><p>which means the present position data will be saved in the first column of "m_dataFromMotor" and the LED status in the second. <br  />
As such, the reading function is: </p><div class="fragment"><div class="line"><span class="comment">// robot.cpp</span></div>
<div class="line"><span class="keywordtype">void</span> <a class="code hl_function" href="../../de/d78/classRobot.html#a4047ab0e78b0d71b7b9fe2b35c40283c">Robot::readData</a>(vector&lt;int&gt; ids, vector&lt;float&gt;&amp; <a class="code hl_function" href="../../de/d5f/speedTest__dxlP1_8cpp.html#a471b9a3284cbcc29aeb5f1c3f90ef6dc">fbck_angles</a>, vector&lt;float&gt;&amp; <a class="code hl_function" href="../../de/d5f/speedTest__dxlP1_8cpp.html#af95c63a39bc09d55df83b3034f6fcd8b">fbck_leds</a>)</div>
<div class="line">{</div>
<div class="line">    <a class="code hl_variable" href="../../de/d78/classRobot.html#a2839307214a5e0165201451a78ba3e0f">m_reader</a>-&gt;<a class="code hl_function" href="../../d3/d54/classKMR_1_1dxlP1_1_1Reader.html#acf41df1f0a00bb3c6b0ada2792dab5b7">syncRead</a>(ids);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;ids.size(); i++) {</div>
<div class="line">        <a class="code hl_function" href="../../de/d5f/speedTest__dxlP1_8cpp.html#a471b9a3284cbcc29aeb5f1c3f90ef6dc">fbck_angles</a>[i] = <a class="code hl_variable" href="../../de/d78/classRobot.html#a2839307214a5e0165201451a78ba3e0f">m_reader</a>-&gt;<a class="code hl_variable" href="../../d3/d54/classKMR_1_1dxlP1_1_1Reader.html#a2409ee0a42d14b9152108469e7708850">m_dataFromMotor</a>[i][0];</div>
<div class="line">        <a class="code hl_function" href="../../de/d5f/speedTest__dxlP1_8cpp.html#af95c63a39bc09d55df83b3034f6fcd8b">fbck_leds</a>[i] = <a class="code hl_variable" href="../../de/d78/classRobot.html#a2839307214a5e0165201451a78ba3e0f">m_reader</a>-&gt;<a class="code hl_variable" href="../../d3/d54/classKMR_1_1dxlP1_1_1Reader.html#a2409ee0a42d14b9152108469e7708850">m_dataFromMotor</a>[i][1];</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">}</div>
<div class="ttc" id="aclassKMR_1_1dxlP1_1_1Reader_html_a2409ee0a42d14b9152108469e7708850"><div class="ttname"><a href="../../d3/d54/classKMR_1_1dxlP1_1_1Reader.html#a2409ee0a42d14b9152108469e7708850">KMR::dxlP1::Reader::m_dataFromMotor</a></div><div class="ttdeci">float * m_dataFromMotor</div><div class="ttdef"><b>Definition</b> KMR_dxlP1_reader.hpp:40</div></div>
<div class="ttc" id="aclassKMR_1_1dxlP1_1_1Reader_html_acf41df1f0a00bb3c6b0ada2792dab5b7"><div class="ttname"><a href="../../d3/d54/classKMR_1_1dxlP1_1_1Reader.html#acf41df1f0a00bb3c6b0ada2792dab5b7">KMR::dxlP1::Reader::syncRead</a></div><div class="ttdeci">void syncRead(std::vector&lt; int &gt; ids)</div><div class="ttdoc">Read the handled fields of input motors.</div><div class="ttdef"><b>Definition</b> KMR_dxlP1_reader.cpp:96</div></div>
<div class="ttc" id="aclassRobot_html_a2839307214a5e0165201451a78ba3e0f"><div class="ttname"><a href="../../de/d78/classRobot.html#a2839307214a5e0165201451a78ba3e0f">Robot::m_reader</a></div><div class="ttdeci">KMR::dxlP1::Reader * m_reader</div><div class="ttdef"><b>Definition</b> robot.hpp:25</div></div>
<div class="ttc" id="aclassRobot_html_a4047ab0e78b0d71b7b9fe2b35c40283c"><div class="ttname"><a href="../../de/d78/classRobot.html#a4047ab0e78b0d71b7b9fe2b35c40283c">Robot::readData</a></div><div class="ttdeci">void readData(std::vector&lt; int &gt; ids, std::vector&lt; float &gt; &amp;fbck_angles)</div><div class="ttdef"><b>Definition</b> robot.cpp:50</div></div>
<div class="ttc" id="aspeedTest__dxlP1_8cpp_html_a471b9a3284cbcc29aeb5f1c3f90ef6dc"><div class="ttname"><a href="../../de/d5f/speedTest__dxlP1_8cpp.html#a471b9a3284cbcc29aeb5f1c3f90ef6dc">fbck_angles</a></div><div class="ttdeci">vector&lt; float &gt; fbck_angles(NBR_MOTORS, 0)</div></div>
<div class="ttc" id="aspeedTest__dxlP1_8cpp_html_af95c63a39bc09d55df83b3034f6fcd8b"><div class="ttname"><a href="../../de/d5f/speedTest__dxlP1_8cpp.html#af95c63a39bc09d55df83b3034f6fcd8b">fbck_leds</a></div><div class="ttdeci">vector&lt; float &gt; fbck_leds(NBR_MOTORS)</div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md16"></a>
Note: multiturn reset</h2>
<p>The public method KMR::dxl::BaseRobot::resetMultiturnMotors resets the motors flagged as in need of a reset. It is inherited by the <a class="el" href="../../de/d78/classRobot.html">Robot</a> class, and needs to be called only if the project contains multiturn motors.</p>
<p>It is up to the user where they want to call it. A good idea is to call it at the start of each control loop, before reading the sensor values. <br  />
If wished, one can also add it for example at the end of the writing functions.</p>
<blockquote class="doxtable">
<p>&zwj;<b>Warning</b> <br  />
 If the resetMultiturnMotors method is called at the end of the writing method, make sure the motors had enough time to execute the movement before calling the reset, such as by adding a short sleep time. If they are reset before they could execute the whole movement, it results in undefined behavior. </p>
</blockquote>
<h1><a class="anchor" id="autotoc_md17"></a>
III. Create a Robot object</h1>
<p>Keeping the previous examples, a very basic project could look like this: </p><div class="fragment"><div class="line"><span class="comment">// main.cpp</span></div>
<div class="line"> </div>
<div class="line">KMR::dxl::Hal hal;</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">char</span> path_to_motor_config[] = <span class="stringliteral">&quot;../config/motors_config.yaml&quot;</span>;</div>
<div class="line"><span class="keywordtype">char</span> path_to_KMR_dxl[] = <span class="stringliteral">&quot;../KMR_dxl&quot;</span>;</div>
<div class="line"> </div>
<div class="line">std::vector&lt;int&gt; all_ids = hal.init(path_to_motor_config, path_to_KMR_dxl);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Create robot instance</span></div>
<div class="line"><span class="keywordtype">int</span> baudrate = 1000000;</div>
<div class="line"><a class="code hl_class" href="../../de/d78/classRobot.html">Robot</a> robot(all_ids, <span class="stringliteral">&quot;/dev/ttyUSB0&quot;</span>, baudrate, hal);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Feedback tables</span></div>
<div class="line">vector&lt;float&gt; <a class="code hl_function" href="../../de/d5f/speedTest__dxlP1_8cpp.html#a471b9a3284cbcc29aeb5f1c3f90ef6dc">fbck_angles</a>(4);</div>
<div class="line">vector&lt;float&gt; <a class="code hl_function" href="../../de/d5f/speedTest__dxlP1_8cpp.html#af95c63a39bc09d55df83b3034f6fcd8b">fbck_leds</a>(4);</div>
<div class="line">vector&lt;float&gt; <a class="code hl_function" href="../../de/d5f/speedTest__dxlP1_8cpp.html#a2ba8fedc8f987dfe2e5db2e3632d3edb">goal_angles</a>(4);</div>
<div class="line">vector&lt;float&gt; <a class="code hl_function" href="../../de/d5f/speedTest__dxlP1_8cpp.html#a9e3026d27bbf8fd952cee0a186c9abff">goal_leds</a>(4);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Start the loop</span></div>
<div class="line">robot.enableMotors();</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">while</span>(1) {</div>
<div class="line">    <span class="comment">// Only needed if there are multiturn motors</span></div>
<div class="line">    robot.resetMultiturnMotors();</div>
<div class="line"> </div>
<div class="line">    robot.readData(all_ids, <a class="code hl_function" href="../../de/d5f/speedTest__dxlP1_8cpp.html#a471b9a3284cbcc29aeb5f1c3f90ef6dc">fbck_angles</a>, <a class="code hl_function" href="../../de/d5f/speedTest__dxlP1_8cpp.html#af95c63a39bc09d55df83b3034f6fcd8b">fbck_leds</a>);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Send the feedback values to the controller and get the new</span></div>
<div class="line">    <span class="comment">// goal values into goal_angles and goal_leds</span></div>
<div class="line"> </div>
<div class="line">    robot.writeData(<a class="code hl_function" href="../../de/d5f/speedTest__dxlP1_8cpp.html#a2ba8fedc8f987dfe2e5db2e3632d3edb">goal_angles</a>, <a class="code hl_function" href="../../de/d5f/speedTest__dxlP1_8cpp.html#a9e3026d27bbf8fd952cee0a186c9abff">goal_leds</a>, all_ids);</div>
<div class="line"> </div>
<div class="line">    sleep(1);</div>
<div class="line">}</div>
<div class="ttc" id="aspeedTest__dxlP1_8cpp_html_a2ba8fedc8f987dfe2e5db2e3632d3edb"><div class="ttname"><a href="../../de/d5f/speedTest__dxlP1_8cpp.html#a2ba8fedc8f987dfe2e5db2e3632d3edb">goal_angles</a></div><div class="ttdeci">vector&lt; float &gt; goal_angles(NBR_MOTORS)</div></div>
<div class="ttc" id="aspeedTest__dxlP1_8cpp_html_a9e3026d27bbf8fd952cee0a186c9abff"><div class="ttname"><a href="../../de/d5f/speedTest__dxlP1_8cpp.html#a9e3026d27bbf8fd952cee0a186c9abff">goal_leds</a></div><div class="ttdeci">vector&lt; int &gt; goal_leds(NBR_MOTORS, 0)</div></div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
